!function(){function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,c=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(u){r=!0,c=u}finally{try{i||null==a.return||a.return()}finally{if(r)throw c}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{B3RB:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("ofXK"),r=n("fXoL"),o=function(){var t=function t(){c(this,t)};return t.\u0275mod=r.Kb({type:t}),t.\u0275inj=r.Jb({factory:function(e){return new(e||t)},imports:[[i.c]]}),t}()},Rbwx:function(n,i,o){"use strict";o.r(i),o.d(i,"SalesReportModule",function(){return C});var a,u=o("ofXK"),l=o("tyNb"),b=o("3Pt+"),s=o("2Vo4"),d=o("itXk"),f=o("lJxs"),p=o("vkgz"),S=o("fXoL"),g=o("tk/3"),v=o("2qjx"),y=((a=function(){function t(e,n){c(this,t),this.http=e,this.productService=n,this.products$=this.productService.loadProducts$}return r(t,[{key:"getReport",value:function(t){var n=o("r8II").stringify({start_date:t.startDate,end_date:t.endDate}),i=this.http.get("api/reports/sales/?".concat(n)).pipe(Object(f.a)(function(t){return t.map(function(t){return{quantity:t.quantity,productId:t.product_id,sellingPrice:t.selling_price,fifoPrice:t.fifo_purchase_price,sellingPriceCurrency:t.selling_price_currency,date:new Date(t.created_at).toISOString().substr(0,10),time:new Date(t.created_at).toISOString().substr(11,8)}})}));return Object(d.a)([this.products$,i]).pipe(Object(f.a)(function(t){var n=e(t,2),i=n[0];return n[1].map(function(t){var e,n;return Object.assign(Object.assign({},t),{productName:null===(e=i.find(function(e){var n=e.id;return t.productId===n}))||void 0===e?void 0:e.name,definedPurchasePrice:null===(n=i.find(function(e){var n=e.id;return t.productId===n}))||void 0===n?void 0:n.buyingPrice})})}))}}]),t}()).\u0275fac=function(t){return new(t||a)(S.Wb(g.b),S.Wb(v.a))},a.\u0275prov=S.Ib({token:a,factory:a.\u0275fac,providedIn:"root"}),a),m=o("hVnv"),h=o("oGmh");function R(t,e){1&t&&S.Nb(0,"i",16)}function P(t,e){1&t&&S.Nb(0,"i",17)}function A(t,e){1&t&&(S.Sb(0,"section",18),S.Nb(1,"app-print",19),S.Rb())}function j(t,e){if(1&t&&(S.Sb(0,"tr"),S.Sb(1,"td",22),S.Ac(2),S.Rb(),S.Sb(3,"td",23),S.Ac(4),S.Rb(),S.Sb(5,"td"),S.Ac(6),S.cc(7,"titlecase"),S.Rb(),S.Sb(8,"td"),S.Ac(9),S.Rb(),S.Sb(10,"td"),S.Ac(11),S.cc(12,"currency"),S.Rb(),S.Sb(13,"td"),S.Ac(14),S.cc(15,"currency"),S.Rb(),S.Sb(16,"td",23),S.Ac(17),S.cc(18,"currency"),S.Rb(),S.Sb(19,"td"),S.Ac(20),S.cc(21,"currency"),S.Rb(),S.Sb(22,"td"),S.Ac(23),S.cc(24,"number"),S.Rb(),S.Rb()),2&t){var n=e.$implicit;S.Ab(1),S.Bb("title",n.date+" "+n.time),S.Ab(1),S.Bc(n.date),S.Ab(2),S.Cc("#",n.productId,""),S.Ab(2),S.Bc(S.dc(7,10,n.productName)),S.Ab(3),S.Bc(n.quantity),S.Ab(2),S.Bc(S.ec(12,12,n.fifoPrice," ")),S.Ab(3),S.Bc(S.ec(15,15,n.sellingPrice," ")),S.Ab(3),S.Bc(S.ec(18,18,n.sellingPrice-n.fifoPrice," ")),S.Ab(3),S.Bc(S.ec(21,21,(n.sellingPrice-n.fifoPrice)*n.quantity," ")),S.Ab(3),S.Cc("",S.ec(24,24,(n.sellingPrice-n.fifoPrice)/n.fifoPrice*100,"1.0-2"),"%")}}function I(t,e){1&t&&(S.Sb(0,"tr"),S.Sb(1,"td",31),S.Sb(2,"section",32),S.Ac(3,"No Data Found"),S.Rb(),S.Rb(),S.Rb())}function O(t,e){if(1&t&&(S.Sb(0,"section",20),S.Sb(1,"table",21),S.Sb(2,"thead"),S.Sb(3,"tr"),S.Sb(4,"th",22),S.Ac(5,"Date Time"),S.Rb(),S.Sb(6,"th",23),S.Ac(7,"Product Id"),S.Rb(),S.Sb(8,"th"),S.Ac(9,"Product Name"),S.Rb(),S.Sb(10,"th"),S.Ac(11,"Quantity Sold"),S.Rb(),S.Sb(12,"th"),S.Ac(13,"FIFO Price"),S.Rb(),S.Sb(14,"th"),S.Ac(15,"Selling Price"),S.Rb(),S.Sb(16,"th",23),S.Ac(17,"Profit Per Unit"),S.Rb(),S.Sb(18,"th",24),S.Ac(19,"Profit"),S.Rb(),S.Sb(20,"th",25),S.Ac(21,"Margin"),S.Rb(),S.Rb(),S.Rb(),S.Sb(22,"tbody"),S.yc(23,j,25,27,"tr",26),S.cc(24,"async"),S.Rb(),S.Sb(25,"tfoot"),S.yc(26,I,4,0,"tr",27),S.Rb(),S.Rb(),S.Sb(27,"section",28),S.Sb(28,"section",29),S.Sb(29,"section",30),S.Sb(30,"span"),S.Ac(31,"TOTAL SALES"),S.Rb(),S.Sb(32,"span"),S.Sb(33,"strong"),S.Ac(34),S.cc(35,"currency"),S.Rb(),S.Rb(),S.Rb(),S.Sb(36,"section",30),S.Sb(37,"span"),S.Ac(38,"TOTAL COGS"),S.Rb(),S.Sb(39,"span"),S.Sb(40,"strong"),S.Ac(41),S.cc(42,"currency"),S.Rb(),S.Rb(),S.Rb(),S.Sb(43,"section",30),S.Sb(44,"span"),S.Ac(45,"TOTAL GROSS PROFIT"),S.Rb(),S.Sb(46,"span"),S.Sb(47,"strong"),S.Ac(48),S.cc(49,"currency"),S.Rb(),S.Rb(),S.Rb(),S.Sb(50,"section",30),S.Sb(51,"span"),S.Ac(52,"GROSS PROFIT MARGIN"),S.Rb(),S.Sb(53,"span"),S.Sb(54,"strong"),S.Ac(55),S.cc(56,"number"),S.Rb(),S.Rb(),S.Rb(),S.Rb(),S.Rb(),S.Rb()),2&t){var n=S.bc();S.Ab(23),S.hc("ngForOf",S.dc(24,6,n.filteredData$)),S.Ab(3),S.hc("ngIf",n.reportData.length<1),S.Ab(8),S.Bc(S.ec(35,8,n.totalSales,"KES ")),S.Ab(7),S.Bc(S.ec(42,11,n.totalCogs,"KES ")),S.Ab(7),S.Bc(S.ec(49,14,n.totalSales-n.totalCogs,"KES ")),S.Ab(7),S.Cc("",S.ec(56,17,(n.totalSales-n.totalCogs)/n.totalCogs*100,"1.0-2"),"%")}}var w,x,D,B=[{path:"",pathMatch:"full",data:{breadcrumb:null},component:(w=function(){function n(i,r){var o,a;c(this,n),this.fb=i,this.salesReportService=r,this.salesReportForm=this.fb.group({startDate:[(new Date).toISOString().substr(0,10),[b.v.required]],endDate:[(new Date).toISOString().substr(0,10),[b.v.required]],cumulateByProduct:[!0],cumulateByDate:[!0]}),this.isSubmittingSubject$=new s.a(!1),this.isSubmittingAction$=this.isSubmittingSubject$.asObservable(),this.cumulateByProductSubject$=new s.a(null===(o=this.salesReportForm.get("cumulateByProduct"))||void 0===o?void 0:o.value),this.cumulateByDateSubject$=new s.a(null===(a=this.salesReportForm.get("cumulateByDate"))||void 0===a?void 0:a.value),this.dataChangedSubject$=new s.a([]),this.filteredData$=Object(d.a)([this.cumulateByProductSubject$.asObservable(),this.cumulateByDateSubject$.asObservable(),this.dataChangedSubject$.asObservable()]).pipe(Object(f.a)(function(n){var i=e(n,3),r=i[0],c=i[1],o=i[2];return r&&!c?o.reduce(function(e,n){var i,r,c,o,a,u,l=(null===(i=e[n.productId])||void 0===i?void 0:i.quantity)?null===(r=e[n.productId])||void 0===r?void 0:r.quantity:0,b=(null===(c=e[n.productId])||void 0===c?void 0:c.fifoPrice)?null===(o=e[n.productId])||void 0===o?void 0:o.fifoPrice:0,s=(null===(a=e[n.productId])||void 0===a?void 0:a.sellingPrice)?null===(u=e[n.productId])||void 0===u?void 0:u.sellingPrice:0,d=Number(l||0)+Number(n.quantity),f=(l*b+n.quantity*n.fifoPrice)/d,p=(l*s+n.quantity*n.sellingPrice)/d;return Object.assign(Object.assign({},e),t({},n.productId,Object.assign(Object.assign({},n),{quantity:d,fifoPrice:f,sellingPricePrice:p,date:"##/##/####"})))},{}):!r&&c?o.reduce(function(e,n){var i,r,c,o,a,u,l=(null===(i=e[n.date])||void 0===i?void 0:i.quantity)?null===(r=e[n.date])||void 0===r?void 0:r.quantity:0,b=(null===(c=e[n.date])||void 0===c?void 0:c.fifoPrice)?null===(o=e[n.date])||void 0===o?void 0:o.fifoPrice:0,s=(null===(a=e[n.date])||void 0===a?void 0:a.sellingPrice)?null===(u=e[n.date])||void 0===u?void 0:u.sellingPrice:0,d=Number(l||0)+Number(n.quantity),f=(l*b+n.quantity*n.fifoPrice)/d,p=(l*s+n.quantity*n.sellingPrice)/d;return Object.assign(Object.assign({},e),t({},n.date,Object.assign(Object.assign({},n),{quantity:d,fifoPrice:f,sellingPricePrice:p,productName:"Daily Sale",productId:"#####"})))},{}):r&&c?o.reduce(function(e,n){var i,r,c,o,a,u,l=(null===(i=e[String(n.date)+String(n.productId)])||void 0===i?void 0:i.quantity)?null===(r=e[String(n.date)+String(n.productId)])||void 0===r?void 0:r.quantity:0,b=(null===(c=e[String(n.date)+String(n.productId)])||void 0===c?void 0:c.fifoPrice)?null===(o=e[String(n.date)+String(n.productId)])||void 0===o?void 0:o.fifoPrice:0,s=(null===(a=e[String(n.date)+String(n.productId)])||void 0===a?void 0:a.sellingPrice)?null===(u=e[String(n.date)+String(n.productId)])||void 0===u?void 0:u.sellingPrice:0,d=Number(l||0)+Number(n.quantity),f=(l*b+n.quantity*n.fifoPrice)/d,p=(l*s+n.quantity*n.sellingPrice)/d;return Object.assign(Object.assign({},e),t({},String(n.date)+String(n.productId),Object.assign(Object.assign({},n),{quantity:d,fifoPrice:f,sellingPricePrice:p})))},{}):o}),Object(f.a)(function(t){return Object.values(t)})),this.dataRetrieved=!1}return r(n,[{key:"ngOnInit",value:function(){var t,e,n=this;this.getSalesReport(),null===(t=this.salesReportForm.get("cumulateByProduct"))||void 0===t||t.valueChanges.subscribe({next:function(t){return n.cumulateByProductSubject$.next(t)}}),null===(e=this.salesReportForm.get("cumulateByDate"))||void 0===e||e.valueChanges.subscribe({next:function(t){return n.cumulateByDateSubject$.next(t)}})}},{key:"getSalesReport",value:function(){var t=this;this.isSubmittingSubject$.next(!0),this.salesReportService.getReport(this.salesReportForm.value).pipe(Object(p.a)(function(e){return t.dataChangedSubject$.next(e)})).subscribe({next:function(e){t.dataRetrieved=!0,t.reportData=e,t.isSubmittingSubject$.next(!1)},error:function(){return t.isSubmittingSubject$.next(!1)}})}},{key:"totalSales",get:function(){var t;return null===(t=this.reportData)||void 0===t?void 0:t.reduce(function(t,e){return t+e.sellingPrice*e.quantity},0)}},{key:"totalCogs",get:function(){var t;return null===(t=this.reportData)||void 0===t?void 0:t.reduce(function(t,e){return t+e.fifoPrice*e.quantity},0)}}]),n}(),w.\u0275fac=function(t){return new(t||w)(S.Mb(b.d),S.Mb(y))},w.\u0275cmp=S.Gb({type:w,selectors:[["app-sales-report"]],decls:28,vars:10,consts:[[3,"formGroup","submit"],[1,"d-flex","align-items-end","flex-wrap"],[1,"col-sm-6","col-md-6","col-lg-4","col-xl-3"],["for","startDate",1,"control-label"],["formControlName","startDate","type","date","id","startDate",1,"form-control"],["for","endDate",1,"control-label"],["formControlName","endDate","type","date","id","endDate",1,"form-control"],[1,"col-sm-6","col-md-6","col-lg-4","col-xl-3","mt-md-2","mt-sm-2"],[1,"d-flex","justify-content-between"],["formControlName","cumulateByDate","label","Date"],["formControlName","cumulateByProduct","label","Product"],[1,"btn","btn-primary",3,"disabled"],["class","icon-ok",4,"ngIf"],["class","icon-spin3 animate-spin",4,"ngIf"],["class","text-right",4,"ngIf"],["class","printable",4,"ngIf"],[1,"icon-ok"],[1,"icon-spin3","animate-spin"],[1,"text-right"],["selector",".printable"],[1,"printable"],[1,"table","table-dark","mt-3"],[1,"d-none","d-xl-inline-block"],[1,"d-none","d-lg-inline-block"],["title","Profit"],["title","Gross Profit Margin"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card","mt-3"],[1,"d-flex","justify-content-around","flex-wrap"],[1,"col-lg-5","d-flex","justify-content-between","p-3"],["colspan","7"],[1,"alert","alert-info"]],template:function(t,e){1&t&&(S.Sb(0,"h1"),S.Ac(1,"Sales Report"),S.Rb(),S.Sb(2,"form",0),S.Zb("submit",function(){return e.getSalesReport()}),S.Sb(3,"section",1),S.Sb(4,"section",2),S.Sb(5,"label",3),S.Ac(6,"From"),S.Rb(),S.Nb(7,"input",4),S.Rb(),S.Sb(8,"section",2),S.Sb(9,"label",5),S.Ac(10,"To"),S.Rb(),S.Nb(11,"input",6),S.Rb(),S.Sb(12,"section",7),S.Sb(13,"fieldset"),S.Sb(14,"legend"),S.Ac(15,"Group By"),S.Rb(),S.Sb(16,"section",8),S.Nb(17,"app-checkbox",9),S.Nb(18,"app-checkbox",10),S.Rb(),S.Rb(),S.Rb(),S.Sb(19,"section",7),S.Sb(20,"button",11),S.Ac(21," Generate Report "),S.yc(22,R,1,0,"i",12),S.cc(23,"async"),S.yc(24,P,1,0,"i",13),S.cc(25,"async"),S.Rb(),S.Rb(),S.Rb(),S.Rb(),S.yc(26,A,2,0,"section",14),S.yc(27,O,57,20,"section",15)),2&t&&(S.Ab(2),S.hc("formGroup",e.salesReportForm),S.Ab(18),S.hc("disabled",e.salesReportForm.invalid),S.Ab(2),S.hc("ngIf",e.salesReportForm.valid&&!1===S.dc(23,6,e.isSubmittingAction$)),S.Ab(2),S.hc("ngIf",S.dc(25,8,e.isSubmittingAction$)),S.Ab(2),S.hc("ngIf",e.dataRetrieved),S.Ab(1),S.hc("ngIf",e.dataRetrieved))},directives:[b.x,b.n,b.h,b.b,b.m,b.g,m.a,u.n,h.a,u.m],pipes:[u.b,u.d,u.f,u.u],styles:[""]}),w)}],q=((x=function t(){c(this,t)}).\u0275mod=S.Kb({type:x}),x.\u0275inj=S.Jb({factory:function(t){return new(t||x)},imports:[[l.j.forChild(B)],l.j]}),x),k=o("RecK"),N=o("B3RB"),$=o("IVO7"),C=((D=function t(){c(this,t)}).\u0275mod=S.Kb({type:D}),D.\u0275inj=S.Jb({factory:function(t){return new(t||D)},imports:[[u.c,q,b.j,b.s,k.a,N.a,$.a]]}),D)},bxdZ:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("fXoL"),o=function(){var t=function(){function t(){c(this,t)}return r(t,[{key:"popupPrint",value:function(t){var e=document.querySelector(t).innerHTML,n=window.open("","_blank","top=0,left=0,height=auto,width=auto");null==n||n.document.open(),null==n||n.document.write('\n      <html>\n        <head>\n          <title>Print tab</title>\n          <style>\n            .d-flex  {\n              width: 100%;\n              display: flex;\n              justify-content: between;\n            }\n            .table {\n              text-align: left;\n              width: 100%;\n              margin-bottom: 1rem;\n            }\n            .table td, .table th {\n              padding: .75rem;\n              vertical-align: top;\n              border-top: 1px solid #dee2e6;\n            }\n            td {\n              display: table-cell;\n            }\n            @media print {\n              .d-print-none {\n                display: none;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <section class=\'d-print-none\'>\n            <button onclick="window.print();">Print</button>\n            <button onclick="window.close();">Cancel</button>\n          </section>\n         '.concat(e,"\n        </body>\n        <script>\n          window.print();\n        <\/script>\n      </html>"))}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},oGmh:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("fXoL"),o=n("bxdZ"),a=function(){var t=function(){function t(e){c(this,t),this.printService=e}return r(t,[{key:"print",value:function(){this.printService.popupPrint(this.selector)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(i.Mb(o.a))},t.\u0275cmp=i.Gb({type:t,selectors:[["app-print"]],inputs:{selector:"selector"},decls:3,vars:0,consts:[["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"icon-print"]],template:function(t,e){1&t&&(i.Sb(0,"button",0),i.Zb("click",function(){return e.print()}),i.Ac(1,"Print "),i.Nb(2,"span",1),i.Rb())},styles:[""]}),t}()}}])}();