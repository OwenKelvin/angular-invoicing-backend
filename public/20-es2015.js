(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{B3RB:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("ofXK"),c=n("fXoL");let r=(()=>{class t{}return t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({factory:function(e){return new(e||t)},imports:[[i.c]]}),t})()},Rbwx:function(t,e,n){"use strict";n.r(e),n.d(e,"SalesReportModule",function(){return w});var i=n("ofXK"),c=n("tyNb"),r=n("3Pt+"),o=n("2Vo4"),a=n("itXk"),s=n("lJxs"),b=n("vkgz"),l=n("fXoL"),u=n("tk/3"),d=n("2qjx");let p=(()=>{class t{constructor(t,e){this.http=t,this.productService=e,this.products$=this.productService.loadProducts$}getReport(t){const e=n("r8II").stringify({start_date:t.startDate,end_date:t.endDate}),i=this.http.get(`api/reports/sales/?${e}`).pipe(Object(s.a)(t=>t.map(t=>({quantity:t.quantity,productId:t.product_id,sellingPrice:t.selling_price,fifoPrice:t.fifo_purchase_price,sellingPriceCurrency:t.selling_price_currency,date:new Date(t.created_at).toISOString().substr(0,10),time:new Date(t.created_at).toISOString().substr(11,8)}))));return Object(a.a)([this.products$,i]).pipe(Object(s.a)(([t,e])=>e.map(e=>{var n,i;return Object.assign(Object.assign({},e),{productName:null===(n=t.find(({id:t})=>e.productId===t))||void 0===n?void 0:n.name,definedPurchasePrice:null===(i=t.find(({id:t})=>e.productId===t))||void 0===i?void 0:i.buyingPrice})})))}}return t.\u0275fac=function(e){return new(e||t)(l.Wb(u.b),l.Wb(d.a))},t.\u0275prov=l.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=n("hVnv"),S=n("oGmh");function g(t,e){1&t&&l.Nb(0,"i",16)}function m(t,e){1&t&&l.Nb(0,"i",17)}function v(t,e){1&t&&(l.Sb(0,"section",18),l.Nb(1,"app-print",19),l.Rb())}function h(t,e){if(1&t&&(l.Sb(0,"tr"),l.Sb(1,"td",22),l.Ac(2),l.Rb(),l.Sb(3,"td",23),l.Ac(4),l.Rb(),l.Sb(5,"td"),l.Ac(6),l.cc(7,"titlecase"),l.Rb(),l.Sb(8,"td"),l.Ac(9),l.Rb(),l.Sb(10,"td"),l.Ac(11),l.cc(12,"currency"),l.Rb(),l.Sb(13,"td"),l.Ac(14),l.cc(15,"currency"),l.Rb(),l.Sb(16,"td",23),l.Ac(17),l.cc(18,"currency"),l.Rb(),l.Sb(19,"td"),l.Ac(20),l.cc(21,"currency"),l.Rb(),l.Sb(22,"td"),l.Ac(23),l.cc(24,"number"),l.Rb(),l.Rb()),2&t){const t=e.$implicit;l.Ab(1),l.Bb("title",t.date+" "+t.time),l.Ab(1),l.Bc(t.date),l.Ab(2),l.Cc("#",t.productId,""),l.Ab(2),l.Bc(l.dc(7,10,t.productName)),l.Ab(3),l.Bc(t.quantity),l.Ab(2),l.Bc(l.ec(12,12,t.fifoPrice," ")),l.Ab(3),l.Bc(l.ec(15,15,t.sellingPrice," ")),l.Ab(3),l.Bc(l.ec(18,18,t.sellingPrice-t.fifoPrice," ")),l.Ab(3),l.Bc(l.ec(21,21,(t.sellingPrice-t.fifoPrice)*t.quantity," ")),l.Ab(3),l.Cc("",l.ec(24,24,(t.sellingPrice-t.fifoPrice)/t.fifoPrice*100,"1.0-2"),"%")}}function R(t,e){1&t&&(l.Sb(0,"tr"),l.Sb(1,"td",31),l.Sb(2,"section",32),l.Ac(3,"No Data Found"),l.Rb(),l.Rb(),l.Rb())}function y(t,e){if(1&t&&(l.Sb(0,"section",20),l.Sb(1,"table",21),l.Sb(2,"thead"),l.Sb(3,"tr"),l.Sb(4,"th",22),l.Ac(5,"Date Time"),l.Rb(),l.Sb(6,"th",23),l.Ac(7,"Product Id"),l.Rb(),l.Sb(8,"th"),l.Ac(9,"Product Name"),l.Rb(),l.Sb(10,"th"),l.Ac(11,"Quantity Sold"),l.Rb(),l.Sb(12,"th"),l.Ac(13,"FIFO Price"),l.Rb(),l.Sb(14,"th"),l.Ac(15,"Selling Price"),l.Rb(),l.Sb(16,"th",23),l.Ac(17,"Profit Per Unit"),l.Rb(),l.Sb(18,"th",24),l.Ac(19,"Profit"),l.Rb(),l.Sb(20,"th",25),l.Ac(21,"Margin"),l.Rb(),l.Rb(),l.Rb(),l.Sb(22,"tbody"),l.yc(23,h,25,27,"tr",26),l.cc(24,"async"),l.Rb(),l.Sb(25,"tfoot"),l.yc(26,R,4,0,"tr",27),l.Rb(),l.Rb(),l.Sb(27,"section",28),l.Sb(28,"section",29),l.Sb(29,"section",30),l.Sb(30,"span"),l.Ac(31,"TOTAL SALES"),l.Rb(),l.Sb(32,"span"),l.Sb(33,"strong"),l.Ac(34),l.cc(35,"currency"),l.Rb(),l.Rb(),l.Rb(),l.Sb(36,"section",30),l.Sb(37,"span"),l.Ac(38,"TOTAL COGS"),l.Rb(),l.Sb(39,"span"),l.Sb(40,"strong"),l.Ac(41),l.cc(42,"currency"),l.Rb(),l.Rb(),l.Rb(),l.Sb(43,"section",30),l.Sb(44,"span"),l.Ac(45,"TOTAL GROSS PROFIT"),l.Rb(),l.Sb(46,"span"),l.Sb(47,"strong"),l.Ac(48),l.cc(49,"currency"),l.Rb(),l.Rb(),l.Rb(),l.Sb(50,"section",30),l.Sb(51,"span"),l.Ac(52,"GROSS PROFIT MARGIN"),l.Rb(),l.Sb(53,"span"),l.Sb(54,"strong"),l.Ac(55),l.cc(56,"number"),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Rb()),2&t){const t=l.bc();l.Ab(23),l.hc("ngForOf",l.dc(24,6,t.filteredData$)),l.Ab(3),l.hc("ngIf",t.reportData.length<1),l.Ab(8),l.Bc(l.ec(35,8,t.totalSales,"KES ")),l.Ab(7),l.Bc(l.ec(42,11,t.totalCogs,"KES ")),l.Ab(7),l.Bc(l.ec(49,14,t.totalSales-t.totalCogs,"KES ")),l.Ab(7),l.Cc("",l.ec(56,17,(t.totalSales-t.totalCogs)/t.totalCogs*100,"1.0-2"),"%")}}const P=[{path:"",pathMatch:"full",data:{breadcrumb:null},component:(()=>{class t{constructor(t,e){var n,i;this.fb=t,this.salesReportService=e,this.salesReportForm=this.fb.group({startDate:[(new Date).toISOString().substr(0,10),[r.v.required]],endDate:[(new Date).toISOString().substr(0,10),[r.v.required]],cumulateByProduct:[!0],cumulateByDate:[!0]}),this.isSubmittingSubject$=new o.a(!1),this.isSubmittingAction$=this.isSubmittingSubject$.asObservable(),this.cumulateByProductSubject$=new o.a(null===(n=this.salesReportForm.get("cumulateByProduct"))||void 0===n?void 0:n.value),this.cumulateByDateSubject$=new o.a(null===(i=this.salesReportForm.get("cumulateByDate"))||void 0===i?void 0:i.value),this.dataChangedSubject$=new o.a([]),this.filteredData$=Object(a.a)([this.cumulateByProductSubject$.asObservable(),this.cumulateByDateSubject$.asObservable(),this.dataChangedSubject$.asObservable()]).pipe(Object(s.a)(([t,e,n])=>t&&!e?n.reduce((t,e)=>{var n,i,c,r,o,a;const s=(null===(n=t[e.productId])||void 0===n?void 0:n.quantity)?null===(i=t[e.productId])||void 0===i?void 0:i.quantity:0,b=(null===(c=t[e.productId])||void 0===c?void 0:c.fifoPrice)?null===(r=t[e.productId])||void 0===r?void 0:r.fifoPrice:0,l=(null===(o=t[e.productId])||void 0===o?void 0:o.sellingPrice)?null===(a=t[e.productId])||void 0===a?void 0:a.sellingPrice:0,u=Number(s||0)+Number(e.quantity),d=(s*b+e.quantity*e.fifoPrice)/u,p=(s*l+e.quantity*e.sellingPrice)/u;return Object.assign(Object.assign({},t),{[e.productId]:Object.assign(Object.assign({},e),{quantity:u,fifoPrice:d,sellingPricePrice:p,date:"##/##/####"})})},{}):!t&&e?n.reduce((t,e)=>{var n,i,c,r,o,a;const s=(null===(n=t[e.date])||void 0===n?void 0:n.quantity)?null===(i=t[e.date])||void 0===i?void 0:i.quantity:0,b=(null===(c=t[e.date])||void 0===c?void 0:c.fifoPrice)?null===(r=t[e.date])||void 0===r?void 0:r.fifoPrice:0,l=(null===(o=t[e.date])||void 0===o?void 0:o.sellingPrice)?null===(a=t[e.date])||void 0===a?void 0:a.sellingPrice:0,u=Number(s||0)+Number(e.quantity),d=(s*b+e.quantity*e.fifoPrice)/u,p=(s*l+e.quantity*e.sellingPrice)/u;return Object.assign(Object.assign({},t),{[e.date]:Object.assign(Object.assign({},e),{quantity:u,fifoPrice:d,sellingPricePrice:p,productName:"Daily Sale",productId:"#####"})})},{}):t&&e?n.reduce((t,e)=>{var n,i,c,r,o,a;const s=(null===(n=t[String(e.date)+String(e.productId)])||void 0===n?void 0:n.quantity)?null===(i=t[String(e.date)+String(e.productId)])||void 0===i?void 0:i.quantity:0,b=(null===(c=t[String(e.date)+String(e.productId)])||void 0===c?void 0:c.fifoPrice)?null===(r=t[String(e.date)+String(e.productId)])||void 0===r?void 0:r.fifoPrice:0,l=(null===(o=t[String(e.date)+String(e.productId)])||void 0===o?void 0:o.sellingPrice)?null===(a=t[String(e.date)+String(e.productId)])||void 0===a?void 0:a.sellingPrice:0,u=Number(s||0)+Number(e.quantity),d=(s*b+e.quantity*e.fifoPrice)/u,p=(s*l+e.quantity*e.sellingPrice)/u;return Object.assign(Object.assign({},t),{[String(e.date)+String(e.productId)]:Object.assign(Object.assign({},e),{quantity:u,fifoPrice:d,sellingPricePrice:p})})},{}):n),Object(s.a)(t=>Object.values(t))),this.dataRetrieved=!1}ngOnInit(){var t,e;this.getSalesReport(),null===(t=this.salesReportForm.get("cumulateByProduct"))||void 0===t||t.valueChanges.subscribe({next:t=>this.cumulateByProductSubject$.next(t)}),null===(e=this.salesReportForm.get("cumulateByDate"))||void 0===e||e.valueChanges.subscribe({next:t=>this.cumulateByDateSubject$.next(t)})}getSalesReport(){this.isSubmittingSubject$.next(!0),this.salesReportService.getReport(this.salesReportForm.value).pipe(Object(b.a)(t=>this.dataChangedSubject$.next(t))).subscribe({next:t=>{this.dataRetrieved=!0,this.reportData=t,this.isSubmittingSubject$.next(!1)},error:()=>this.isSubmittingSubject$.next(!1)})}get totalSales(){var t;return null===(t=this.reportData)||void 0===t?void 0:t.reduce((t,e)=>t+e.sellingPrice*e.quantity,0)}get totalCogs(){var t;return null===(t=this.reportData)||void 0===t?void 0:t.reduce((t,e)=>t+e.fifoPrice*e.quantity,0)}}return t.\u0275fac=function(e){return new(e||t)(l.Mb(r.d),l.Mb(p))},t.\u0275cmp=l.Gb({type:t,selectors:[["app-sales-report"]],decls:28,vars:10,consts:[[3,"formGroup","submit"],[1,"d-flex","align-items-end","flex-wrap"],[1,"col-sm-6","col-md-6","col-lg-4","col-xl-3"],["for","startDate",1,"control-label"],["formControlName","startDate","type","date","id","startDate",1,"form-control"],["for","endDate",1,"control-label"],["formControlName","endDate","type","date","id","endDate",1,"form-control"],[1,"col-sm-6","col-md-6","col-lg-4","col-xl-3","mt-md-2","mt-sm-2"],[1,"d-flex","justify-content-between"],["formControlName","cumulateByDate","label","Date"],["formControlName","cumulateByProduct","label","Product"],[1,"btn","btn-primary",3,"disabled"],["class","icon-ok",4,"ngIf"],["class","icon-spin3 animate-spin",4,"ngIf"],["class","text-right",4,"ngIf"],["class","printable",4,"ngIf"],[1,"icon-ok"],[1,"icon-spin3","animate-spin"],[1,"text-right"],["selector",".printable"],[1,"printable"],[1,"table","table-dark","mt-3"],[1,"d-none","d-xl-inline-block"],[1,"d-none","d-lg-inline-block"],["title","Profit"],["title","Gross Profit Margin"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card","mt-3"],[1,"d-flex","justify-content-around","flex-wrap"],[1,"col-lg-5","d-flex","justify-content-between","p-3"],["colspan","7"],[1,"alert","alert-info"]],template:function(t,e){1&t&&(l.Sb(0,"h1"),l.Ac(1,"Sales Report"),l.Rb(),l.Sb(2,"form",0),l.Zb("submit",function(){return e.getSalesReport()}),l.Sb(3,"section",1),l.Sb(4,"section",2),l.Sb(5,"label",3),l.Ac(6,"From"),l.Rb(),l.Nb(7,"input",4),l.Rb(),l.Sb(8,"section",2),l.Sb(9,"label",5),l.Ac(10,"To"),l.Rb(),l.Nb(11,"input",6),l.Rb(),l.Sb(12,"section",7),l.Sb(13,"fieldset"),l.Sb(14,"legend"),l.Ac(15,"Group By"),l.Rb(),l.Sb(16,"section",8),l.Nb(17,"app-checkbox",9),l.Nb(18,"app-checkbox",10),l.Rb(),l.Rb(),l.Rb(),l.Sb(19,"section",7),l.Sb(20,"button",11),l.Ac(21," Generate Report "),l.yc(22,g,1,0,"i",12),l.cc(23,"async"),l.yc(24,m,1,0,"i",13),l.cc(25,"async"),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.yc(26,v,2,0,"section",14),l.yc(27,y,57,20,"section",15)),2&t&&(l.Ab(2),l.hc("formGroup",e.salesReportForm),l.Ab(18),l.hc("disabled",e.salesReportForm.invalid),l.Ab(2),l.hc("ngIf",e.salesReportForm.valid&&!1===l.dc(23,6,e.isSubmittingAction$)),l.Ab(2),l.hc("ngIf",l.dc(25,8,e.isSubmittingAction$)),l.Ab(2),l.hc("ngIf",e.dataRetrieved),l.Ab(1),l.hc("ngIf",e.dataRetrieved))},directives:[r.x,r.n,r.h,r.b,r.m,r.g,f.a,i.n,S.a,i.m],pipes:[i.b,i.d,i.f,i.u],styles:[""]}),t})()}];let A=(()=>{class t{}return t.\u0275mod=l.Kb({type:t}),t.\u0275inj=l.Jb({factory:function(e){return new(e||t)},imports:[[c.j.forChild(P)],c.j]}),t})();var j=n("RecK"),I=n("B3RB"),O=n("IVO7");let w=(()=>{class t{}return t.\u0275mod=l.Kb({type:t}),t.\u0275inj=l.Jb({factory:function(e){return new(e||t)},imports:[[i.c,A,r.j,r.s,j.a,I.a,O.a]]}),t})()},bxdZ:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var i=n("fXoL");let c=(()=>{class t{constructor(){}popupPrint(t){const e=document.querySelector(t).innerHTML,n=window.open("","_blank","top=0,left=0,height=auto,width=auto");null==n||n.document.open(),null==n||n.document.write(`\n      <html>\n        <head>\n          <title>Print tab</title>\n          <style>\n            .d-flex  {\n              width: 100%;\n              display: flex;\n              justify-content: between;\n            }\n            .table {\n              text-align: left;\n              width: 100%;\n              margin-bottom: 1rem;\n            }\n            .table td, .table th {\n              padding: .75rem;\n              vertical-align: top;\n              border-top: 1px solid #dee2e6;\n            }\n            td {\n              display: table-cell;\n            }\n            @media print {\n              .d-print-none {\n                display: none;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <section class='d-print-none'>\n            <button onclick="window.print();">Print</button>\n            <button onclick="window.close();">Cancel</button>\n          </section>\n         ${e}\n        </body>\n        <script>\n          window.print();\n        <\/script>\n      </html>`)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},oGmh:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("fXoL"),c=n("bxdZ");let r=(()=>{class t{constructor(t){this.printService=t}print(){this.printService.popupPrint(this.selector)}}return t.\u0275fac=function(e){return new(e||t)(i.Mb(c.a))},t.\u0275cmp=i.Gb({type:t,selectors:[["app-print"]],inputs:{selector:"selector"},decls:3,vars:0,consts:[["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"icon-print"]],template:function(t,e){1&t&&(i.Sb(0,"button",0),i.Zb("click",function(){return e.print()}),i.Ac(1,"Print "),i.Nb(2,"span",1),i.Rb())},styles:[""]}),t})()}}]);