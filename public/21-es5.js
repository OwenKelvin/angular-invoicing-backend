!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],c=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(c=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);c=!0);}catch(u){r=!0,o=u}finally{try{c||null==a.return||a.return()}finally{if(r)throw o}}return n}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,n,c){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var c=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(c){var r=Object.getOwnPropertyDescriptor(c,e);return r.get?r.get.call(n):r.value}})(t,n,c||t)}function n(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,c=new Array(e);n<e;n++)c[n]=t[n];return c}function o(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,c=l(t);if(e){var r=l(this).constructor;n=Reflect.construct(c,arguments,r)}else n=c.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{CG4G:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return function t(){d(this,t)}}();return function(t){a(n,t);var e=b(n);function n(){return d(this,n),e.apply(this,arguments)}return i(n,[{key:"getColorString",value:function(t){return["hsl(",Math.floor(120*t/100),",100%,50%)"].join("")}}]),n}(t)}},U1Ny:function(t,c,r){"use strict";r.r(c),r.d(c,"SalesModule",function(){return xt});var o=r("ofXK"),u=r("tyNb"),s=r("3Pt+"),p=r("2Vo4"),m=r("l7P3"),f=r("nPLa"),h=r("lJxs"),y=r("5+tZ"),S=r("1G5W"),g=r("gJ3R"),v=r("w/e7"),R=[],A=Object(m.p)(R,Object(m.r)(v.d,function(t,e){var c=n(t),r=t.filter(function(t){return t.productId===e.data.productId}),o=t.indexOf(r[0]);return o>=0?(c[o]=Object.assign(Object.assign({},c[o]),{saleQuantity:Number(r[0].saleQuantity)+Number(e.data.saleQuantity)}),c):[].concat(n(c),[e.data])}),Object(m.r)(v.a,function(t,e){var c=n(t),r=t.filter(function(t){return t.productId===e.data.productId}),o=t.indexOf(r[0]);return c[o]=Object.assign(Object.assign({},c[o]),{saleQuantity:Math.max(Number(r[0].saleQuantity)+Number(e.data.changeBy),1)}),c}),Object(m.r)(v.c,function(t,e){return t.filter(function(t){return t.productId!==e.data.productId})}),Object(m.r)(v.b,function(){return R})),I=Object(m.o)("cart"),j=Object(m.q)(I,function(t){return null==t?void 0:t.length}),P=Object(m.q)(I,function(t){return t.reduce(function(t,e){return Number(e.salePrice)*Number(e.saleQuantity)+t},0)}),O=r("+Kmi"),M=r("sEf6"),k=r("fXoL"),w=r("2qjx"),C=r("ChtM"),N=r("ZOsW"),x=r("QlUG"),$=r("dZIy");function F(t,e){if(1&t&&(k.Sb(0,"ng-option",34),k.Ac(1),k.cc(2,"titlecase"),k.Rb()),2&t){var n=e.$implicit;k.hc("value",n.id),k.Ab(1),k.Cc(" ",k.dc(2,2,n.name)," ")}}function T(t,e){if(1&t){var n=k.Tb();k.Sb(0,"li",37),k.Zb("click",function(){k.tc(n);var t=e.$implicit;return k.bc(2).saleCurrency.setValue(t)}),k.Sb(1,"span",38),k.Ac(2),k.Rb(),k.Rb()}if(2&t){var c=e.$implicit;k.Ab(2),k.Bc(c)}}function D(t,e){if(1&t&&(k.Sb(0,"ul",35),k.yc(1,T,3,1,"li",36),k.cc(2,"async"),k.Rb()),2&t){var n=k.bc();k.Ab(1),k.hc("ngForOf",k.dc(2,1,n.currencies$))}}function Z(t,e){1&t&&(k.Sb(0,"span",39),k.Ac(1,"Item added to cart!"),k.Rb())}var E,Q,q=((E=function(t){a(n,t);var e=b(n);function n(t,c,r,o){var i;return d(this,n),(i=e.call(this)).fb=t,i.productService=c,i.currencyService=r,i.store=o,i.newSaleItemForm=i.fb.group({productId:[null,[s.v.required]],saleQuantity:[1,[s.v.required]],salePrice:[null,[s.v.required]],unitPrice:[null],unitPriceCurrency:["KES"],saleCurrency:["KES",[s.v.required]],searchProduct:[""]}),i.cartAdditionSubject$=new p.a(!1),i.cartAdditionAction$=i.cartAdditionSubject$.asObservable(),i.products$=i.productService.loadProducts$,i.currencies$=i.currencyService.currencies$,i.cartItemsCount$=i.store.pipe(Object(m.t)(j)),i.cartItemsPrice$=i.store.pipe(Object(m.t)(P)),i}return i(n,[{key:"ngOnInit",value:function(){var t,e=this;this.newSaleItemForm.valueChanges.subscribe({next:function(){return e.cartAdditionSubject$.next(!1)}}),this.store.dispatch(Object(f.b)()),null===(t=this.newSaleItemForm.get("productId"))||void 0===t||t.valueChanges.pipe(Object(h.a)(function(t){return Number(t)}),Object(y.a)(function(t){return e.store.pipe(Object(m.t)(Object(g.b)({id:t})))}),Object(S.a)(this.destroyed$)).subscribe({next:function(t){var n,c,r,o;null===(n=e.newSaleItemForm.get("unitPrice"))||void 0===n||n.setValue(t.sellingPrice),null===(c=e.newSaleItemForm.get("salePrice"))||void 0===c||c.setValue(t.sellingPrice),null===(r=e.newSaleItemForm.get("saleCurrency"))||void 0===r||r.setValue(t.sellingPriceCurrency),null===(o=e.newSaleItemForm.get("unitPriceCurrency"))||void 0===o||o.setValue(t.sellingPriceCurrency),e.newSaleItemForm.updateValueAndValidity()}})}},{key:"resetForm",value:function(){this.newSaleItemForm.setValue({productId:null,saleQuantity:1,salePrice:null,unitPrice:null,unitPriceCurrency:"KES",saleCurrency:"KES",searchProduct:""}),this.newSaleItemForm.markAsUntouched()}},{key:"saleCurrency",get:function(){return this.newSaleItemForm.get("saleCurrency")}},{key:"unitPriceCurrency",get:function(){return this.newSaleItemForm.get("unitPriceCurrency")}},{key:"newSaleItemFormSubmit",value:function(){this.newSaleItemForm.valid&&(this.store.dispatch(Object(v.d)({data:this.newSaleItemForm.value})),this.resetForm(),this.cartAdditionSubject$.next(!0))}},{key:"closeModal",value:function(){this.itemForm=this.newSaleItemForm,this.closeFormDialog()&&this.store.dispatch(Object(f.a)())}}]),n}(Object(O.a)(Object(M.a)()))).\u0275fac=function(t){return new(t||E)(k.Mb(s.d),k.Mb(w.a),k.Mb(C.a),k.Mb(m.h))},E.\u0275cmp=k.Gb({type:E,selectors:[["app-add-sale-item"]],features:[k.xb],decls:60,vars:20,consts:[[1,"bg-dark"],[3,"formGroup","submit"],[1,"card"],[1,"card-header","d-flex","justify-content-between"],["disabled","","type","button",1,"btn","btn-success"],[1,"icon-cart-plus","mr-3"],[1,"badge","badge-secondary","pt-0"],["type","button",1,"btn","btn-success","ml-2",3,"click"],[1,"icon-ok"],[1,"card-body"],[1,"d-flex","flex-wrap"],[1,"col-lg-6","mt-3"],["for","product",1,"control-label"],["placeholder","Choose a Product","id","product","formControlName","productId"],["role","option",3,"value",4,"ngFor","ngForOf"],["type","number","label","Quantity","placeholder","eg 20","id","purchasePrice","formControlName","saleQuantity"],["for","unitPrice",1,"control-label"],[1,"input-group","mb-3"],[1,"input-group-prepend"],["type","button",1,"btn","bg-light","text-dark"],["readonly","","id","unitPrice","formControlName","unitPrice","type","number",1,"form-control"],["for","salePrice",1,"control-label"],["dropdown","",1,"btn-group"],["id","button-split","type","button","dropdownToggle","","aria-controls","dropdown-split",1,"btn","bg-light","text-dark","dropdown-toggle","dropdown-toggle-split"],[1,"caret"],[1,"sr-only"],["id","dropdown-split","class","dropdown-menu","role","menu","aria-labelledby","button-split",4,"dropdownMenu"],["type","number","id","salePrice","formControlName","salePrice","required","",1,"form-control"],[1,"card-footer","d-flex","justify-content-between"],[1,"btn","btn-primary",3,"disabled"],[1,"icon-cart-plus"],["class","text-success m-2",4,"ngIf"],["type","button",1,"btn","btn-secondary","mr-3",3,"disabled","click"],[1,"icon-cancel"],["role","option",3,"value"],["id","dropdown-split","role","menu","aria-labelledby","button-split",1,"dropdown-menu"],["role","menuitem",3,"click",4,"ngFor","ngForOf"],["role","menuitem",3,"click"],[1,"dropdown-item"],[1,"text-success","m-2"]],template:function(t,e){1&t&&(k.Sb(0,"section",0),k.Sb(1,"form",1),k.Zb("submit",function(){return e.newSaleItemFormSubmit()}),k.Sb(2,"section",2),k.Sb(3,"section",3),k.Sb(4,"h2"),k.Ac(5,"Sale Items"),k.Rb(),k.Sb(6,"span"),k.Sb(7,"button",4),k.Sb(8,"span",5),k.Sb(9,"span",6),k.Ac(10),k.cc(11,"async"),k.Rb(),k.Rb(),k.Ac(12),k.cc(13,"currency"),k.cc(14,"async"),k.Rb(),k.Sb(15,"button",7),k.Zb("click",function(){return e.closeModal()}),k.Nb(16,"span",8),k.Ac(17," View Cart "),k.Rb(),k.Rb(),k.Rb(),k.Sb(18,"section",9),k.Sb(19,"section",10),k.Sb(20,"section",11),k.Sb(21,"label",12),k.Ac(22,"Product"),k.Rb(),k.Sb(23,"ng-select",13),k.yc(24,F,3,4,"ng-option",14),k.cc(25,"async"),k.Rb(),k.Rb(),k.Sb(26,"section",11),k.Nb(27,"app-input",15),k.Rb(),k.Sb(28,"section",11),k.Sb(29,"label",16),k.Ac(30,"Default Selling Price"),k.Rb(),k.Sb(31,"div",17),k.Sb(32,"div",18),k.Sb(33,"button",19),k.Ac(34),k.Rb(),k.Rb(),k.Nb(35,"input",20),k.Rb(),k.Rb(),k.Sb(36,"section",11),k.Sb(37,"label",21),k.Ac(38,"Selling Price"),k.Rb(),k.Sb(39,"div",17),k.Sb(40,"div",18),k.Sb(41,"div",22),k.Sb(42,"button",19),k.Ac(43),k.Rb(),k.Sb(44,"button",23),k.Nb(45,"span",24),k.Sb(46,"span",25),k.Ac(47,"Change Currency"),k.Rb(),k.Rb(),k.yc(48,D,3,3,"ul",26),k.Rb(),k.Rb(),k.Nb(49,"input",27),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Sb(50,"section",28),k.Sb(51,"section"),k.Sb(52,"button",29),k.Ac(53," Add To Cart "),k.Nb(54,"span",30),k.Rb(),k.yc(55,Z,2,0,"span",31),k.cc(56,"async"),k.Rb(),k.Sb(57,"button",32),k.Zb("click",function(){return e.resetForm()}),k.Nb(58,"span",33),k.Ac(59,"Clear"),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Rb()),2&t&&(k.Ab(1),k.hc("formGroup",e.newSaleItemForm),k.Ab(9),k.Bc(k.dc(11,9,e.cartItemsCount$)),k.Ab(2),k.Cc(" Total : ",k.ec(13,11,k.dc(14,14,e.cartItemsPrice$),"KES ")," "),k.Ab(12),k.hc("ngForOf",k.dc(25,16,e.products$)),k.Ab(10),k.Bc(e.unitPriceCurrency.value),k.Ab(9),k.Bc(e.saleCurrency.value),k.Ab(9),k.hc("disabled",e.newSaleItemForm.invalid||!e.newSaleItemForm.dirty),k.Ab(3),k.hc("ngIf",k.dc(56,18,e.cartAdditionAction$)),k.Ab(2),k.hc("disabled",!e.newSaleItemForm.dirty))},directives:[s.x,s.n,s.h,N.a,s.m,s.g,o.m,x.a,s.b,s.q,$.a,$.d,$.b,s.t,o.n,N.c],pipes:[o.b,o.d,o.u],styles:[""]}),E),B=r("vkgz"),K=r("B/gT"),V=r("K3ix"),_=r("kOKB"),G=r("tk/3"),X=((Q=function(){function t(e){var n=this;d(this,t),this.http=e,this.token$=this.http.get("api/m-pesa/access-token"),this.checkPaymentReceipt=function(t){var e=t.mobileNumber,c=t.amount;return n.http.get("api/m-pesa/receipts/?query=".concat(e,"&amount=").concat(c))},this.lipaNaMPesa=function(t){var e=t.mobileNumber;return n.http.post("api/m-pesa/lipa-na-mpesa",{mobile_number:e})}}return i(t,[{key:"getAccountBalance",value:function(){return this.http.get("api/m-pesa/balance")}},{key:"simulateError",value:function(){return this.http.post("api/m-pesa/callback-url",{})}},{key:"simulateResult",value:function(){return this.http.post("api/m-pesa/callback-url",{Body:{stkCallback:{MerchantRequestID:"4358-8482324-1",CheckoutRequestID:"ws_CO_240620201951034354",ResultCode:0,ResultDesc:"The service request is processed successfully.",CallbackMetadata:{Item:[{Name:"Amount",Value:1},{Name:"MpesaReceiptNumber",Value:"OFO1800ZC1"},{Name:"Balance"},{Name:"TransactionDate",Value:20200624195156},{Name:"PhoneNumber",Value:254712692310}]}}}})}}]),t}()).\u0275fac=function(t){return new(t||Q)(k.Wb(G.b))},Q.\u0275prov=k.Ib({token:Q,factory:Q.\u0275fac,providedIn:"root"}),Q);function J(t,e){if(1&t&&(k.Qb(0),k.Ac(1),k.cc(2,"titlecase"),k.Pb()),2&t){var n=e.ngIf;k.Ab(1),k.Cc(" ",k.dc(2,1,n)," ")}}function L(t,e){if(1&t){var n=k.Tb();k.Sb(0,"tr"),k.Sb(1,"td"),k.Ac(2),k.Rb(),k.Sb(3,"td"),k.yc(4,J,3,3,"ng-container",38),k.cc(5,"async"),k.Rb(),k.Sb(6,"td"),k.Ac(7),k.cc(8,"currency"),k.Rb(),k.Sb(9,"td"),k.Sb(10,"section",23),k.Sb(11,"span",39),k.Sb(12,"button",40),k.Zb("click",function(){k.tc(n);var t=e.$implicit;return k.bc().changeQuantity(t.productId,-1)}),k.Nb(13,"span",41),k.Rb(),k.Rb(),k.Sb(14,"span",39),k.Ac(15),k.Rb(),k.Sb(16,"span",39),k.Sb(17,"button",42),k.Zb("click",function(){k.tc(n);var t=e.$implicit;return k.bc().changeQuantity(t.productId,1)}),k.Nb(18,"span",4),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Sb(19,"td",23),k.Ac(20),k.cc(21,"currency"),k.Rb(),k.Sb(22,"td"),k.Sb(23,"button",43),k.Zb("click",function(){k.tc(n);var t=e.$implicit;return k.bc().removeItem(t.productId)}),k.Nb(24,"span",44),k.Rb(),k.Rb(),k.Rb()}if(2&t){var c=e.$implicit,r=k.bc();k.Ab(2),k.Cc(" #",c.productId," "),k.Ab(2),k.hc("ngIf",k.dc(5,6,r.productName(c.productId))),k.Ab(3),k.Bc(k.ec(8,8,c.salePrice," ")),k.Ab(5),k.hc("disabled",c.saleQuantity<=1),k.Ab(3),k.Bc(c.saleQuantity),k.Ab(5),k.Cc(" ",k.ec(21,11,c.salePrice*c.saleQuantity," ")," ")}}function U(t,e){if(1&t){var n=k.Tb();k.Sb(0,"section",12),k.Sb(1,"label",45),k.Ac(2,"Discount Type"),k.Rb(),k.Sb(3,"select",46),k.Zb("ngModelChange",function(t){return k.tc(n),k.bc().discountType=t}),k.Sb(4,"option",47),k.Ac(5,"Absolute"),k.Rb(),k.Sb(6,"option",48),k.Ac(7,"Percentage"),k.Rb(),k.Rb(),k.Rb()}if(2&t){var c=k.bc();k.Ab(3),k.hc("ngModel",c.discountType)}}function W(t,e){if(1&t){var n=k.Tb();k.Sb(0,"section",12),k.Sb(1,"label",49),k.Ac(2,"Discount Value"),k.Rb(),k.Sb(3,"input",50),k.Zb("ngModelChange",function(t){return k.tc(n),k.bc().discountAmount=t}),k.Rb(),k.Rb()}if(2&t){var c=k.bc();k.Ab(3),k.hc("ngModel",c.discountAmount)}}function Y(t,e){if(1&t&&(k.Sb(0,"section",19),k.Sb(1,"section",20),k.Ac(2," Discount Amount "),k.Rb(),k.Sb(3,"section",21),k.Ac(4),k.Rb(),k.Rb()),2&t){var n=k.bc();k.Ab(4),k.Cc(" ",n.discountNetAmount," ")}}function z(t,e){if(1&t){var n=k.Tb();k.Sb(0,"div",51),k.Sb(1,"div",52),k.Sb(2,"label",53),k.Ac(3,"Cash Received"),k.Rb(),k.Sb(4,"input",54),k.Zb("ngModelChange",function(t){return k.tc(n),k.bc().cashReceived=t}),k.Rb(),k.Rb(),k.Sb(5,"div",20),k.Ac(6),k.cc(7,"currency"),k.Rb(),k.Rb()}if(2&t){var c=k.bc();k.Ab(4),k.hc("ngModel",c.cashReceived),k.Ab(2),k.Cc(" Change ",k.ec(7,2,c.cashReceived-(c.cartItemsTotal-c.discountNetAmount),"KES ")," ")}}function H(t,e){if(1&t){var n=k.Tb();k.Sb(0,"div",51),k.Sb(1,"div",52),k.Sb(2,"label",53),k.Ac(3,"Creditor Phone Number"),k.Rb(),k.Sb(4,"input",55),k.Zb("ngModelChange",function(t){return k.tc(n),k.bc().creditorPhoneNumber=t}),k.Rb(),k.Rb(),k.Rb()}if(2&t){var c=k.bc();k.Ab(4),k.hc("ngModel",c.creditorPhoneNumber)}}function tt(t,e){if(1&t){var n=k.Tb();k.Sb(0,"div",51),k.Sb(1,"div",52),k.Sb(2,"label",53),k.Ac(3,"M-Pesa Phone Number"),k.Rb(),k.Sb(4,"input",56),k.Zb("ngModelChange",function(t){return k.tc(n),k.bc().mPesaPhoneNumber=t}),k.Rb(),k.Rb(),k.Sb(5,"div"),k.Sb(6,"button",57),k.Zb("click",function(){return k.tc(n),k.bc().sendMpesaPaymentRequest()}),k.Ac(7,"Send Payment Request"),k.Rb(),k.Sb(8,"button",35),k.Zb("click",function(){return k.tc(n),k.bc().checkPaymentReceipt()}),k.Ac(9,"Check "),k.Rb(),k.Rb(),k.Rb()}if(2&t){var c=k.bc();k.Ab(4),k.hc("ngModel",c.mPesaPhoneNumber),k.Ab(2),k.hc("disabled",c.amountDue<=0),k.Ab(2),k.hc("disabled",c.amountDue<=0)}}function et(t,e){1&t&&k.Nb(0,"i",58)}function nt(t,e){1&t&&k.Nb(0,"i",59)}var ct,rt,ot,it,at,ut,bt=((ct=function(t){a(c,t);var n=b(c);function c(t,e,r,o){var i;return d(this,c),(i=n.call(this)).store=t,i.modalService=e,i.saleService=r,i.mPesaService=o,i.cashReceived=0,i.paymentMethod="cash",i.isDiscounted=!1,i.discountAmount=0,i.discountType="percentage",i.cartItems$=i.store.pipe(Object(m.t)(I),Object(B.a)(function(t){return i.cartItems=t})),i.cartItemsTotal$=i.store.pipe(Object(m.t)(P),Object(B.a)(function(t){return i.cartItemsTotal=t})),i.productName=function(t){return i.store.pipe(Object(m.t)(Object(g.b)({id:t})),Object(h.a)(function(t){return t.name}))},i.storeInjected=i.store,i.modalServiceInjected=i.modalService,i}return i(c,[{key:"ngOnInit",value:function(){this.mPesaService.getAccountBalance().subscribe(function(t){return console.log({res:t})})}},{key:"discountNetAmount",get:function(){return this.isDiscounted&&"absolute"===this.discountType?Number(this.discountAmount):this.isDiscounted&&"percentage"===this.discountType?Number(this.cartItemsTotal)*Number(this.discountAmount)/100:0}},{key:"sendMpesaPaymentRequest",value:function(){this.mPesaService.lipaNaMPesa({mobileNumber:this.mPesaPhoneNumber}).subscribe({next:function(t){console.log(t)}})}},{key:"checkPaymentReceipt",value:function(){alert(this.mPesaPhoneNumber),this.mPesaService.checkPaymentReceipt({amount:this.amountDue,mobileNumber:this.mPesaPhoneNumber}).subscribe({next:function(t){console.log(t)}})}},{key:"amountDue",get:function(){return this.cartItemsTotal-this.discountNetAmount}},{key:"changeQuantity",value:function(t,e){this.store.dispatch(Object(v.a)({data:{productId:t,changeBy:e}}))}},{key:"removeItem",value:function(t){this.store.dispatch(Object(v.c)({data:{productId:t}}))}},{key:"addItems",value:function(){this.openModal({id:0,component:q})}},{key:"submitCart",value:function(){var t=this;this.submitInProgressSubject$.next(!0),this.saleService.saveSale({discount:{type:this.discountType,amount:this.discountAmount},products:this.cartItems,payment:{method:this.paymentMethod,amountReceived:this.cashReceived}}).subscribe({next:function(){t.submitInProgressSubject$.next(!1),t.isDiscounted=!1,t.discountType="percentage",t.discountAmount=0,t.paymentMethod="cash",t.cashReceived=0},error:function(){return t.submitInProgressSubject$.next(!1)}})}},{key:"canDeactivate",value:function(){return confirm("You are exiting the sales page, continue?")}},{key:"ngOnDestroy",value:function(){var t;e(l(c.prototype),"ngOnDestroy",this).call(this),null===(t=this.modalRef)||void 0===t||t.hide()}}]),c}(Object(K.a)(Object(M.a)(Object(O.a)())))).\u0275fac=function(t){return new(t||ct)(k.Mb(m.h),k.Mb(V.a),k.Mb(_.a),k.Mb(X))},ct.\u0275cmp=k.Gb({type:ct,selectors:[["app-sale-summary"]],features:[k.xb],decls:87,vars:30,consts:[[1,"card","p-2"],[1,"card-header","mb-1","pt-1","pl-2"],[1,"d-flex","justify-content-between"],[1,"btn","btn-primary",3,"click"],[1,"icon-plus-circled"],[1,"table","table-dark"],[1,"text-center"],[4,"ngFor","ngForOf"],["colspan","5"],["colspan","4"],[1,"card","p-2","mt-2"],[1,"d-flex","flex-wrap"],[1,"col-lg-3"],[1,"custom-control","custom-switch","mt-3"],["type","checkbox","id","apply-discount",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","apply-discount",1,"custom-control-label"],["class","col-lg-3",4,"ngIf"],[1,"d-flex","flex-wrap","mt-3","p-3","pb-4"],["class","col-lg-12 d-flex justify-content-end mt-2",4,"ngIf"],[1,"col-lg-12","d-flex","justify-content-end","mt-2"],[1,"col-lg-4"],[1,"col-lg-2"],[1,"card","p-2","mt-2",2,"position","relative"],[1,"d-flex","flex-wrap","justify-content-between"],[1,"col-lg-6","mt-2","mb-2","d-flex","justify-content-between"],[1,"custom-control","custom-radio"],["value","cash","type","radio","id","payment-method-cash",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","payment-method-cash",1,"custom-control-label"],["disabled","","value","on-credit","type","radio","id","payment-method-on-credit",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","payment-method-on-credit",1,"custom-control-label"],["value","m-pesa","type","radio","id","payment-method-m-pesa",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","payment-method-m-pesa",1,"custom-control-label"],["class","col-lg-8 d-flex justify-content-between align-items-end",4,"ngIf"],[1,"d-flex","mt-2"],[1,"col-lg-12","d-flex","justify-content-end"],["type","button",1,"btn","btn-success",3,"disabled","click"],["class","icon-ok",4,"ngIf"],["class","icon-spin3 animate-spin",4,"ngIf"],[4,"ngIf"],[1,"col-sm-12","col-md-12","col-lg-3","text-center"],["aria-label","Reduce Quantity",1,"btn","btn-secondary","btn-sm",3,"disabled","click"],[1,"icon-minus-circled"],["aria-label","Reduce Quantity",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-label","Remove",1,"btn","btn-danger","btn-sm",3,"click"],[1,"icon-cancel-circled"],["for","discountType"],["id","discountType",1,"custom-select",3,"ngModel","ngModelChange"],["selected","","value","absolute"],["value","percentage"],["for","discountAmount"],["id","discountAmount",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-lg-8","d-flex","justify-content-between","align-items-end"],[1,"col-lg-5","p-0"],["for","cashReceived"],["type","text","id","cashReceived",1,"form-control",3,"ngModel","ngModelChange"],["type","text","id","creditorPhoneNumber",1,"form-control",3,"ngModel","ngModelChange"],["type","tel","placeholder","2547XXXXXXXX","type","text","id","creditorPhoneNumber",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary","mr-2",3,"disabled","click"],[1,"icon-ok"],[1,"icon-spin3","animate-spin"]],template:function(t,e){1&t&&(k.Sb(0,"h1"),k.Ac(1,"Sale"),k.Rb(),k.Sb(2,"section"),k.Sb(3,"div",0),k.Sb(4,"h2",1),k.Ac(5,"Items in Cart"),k.Rb(),k.Sb(6,"section",2),k.Sb(7,"button",3),k.Zb("click",function(){return e.addItems()}),k.Sb(8,"span",4),k.Ac(9,"Add Item"),k.Rb(),k.Rb(),k.Rb(),k.Sb(10,"table",5),k.Sb(11,"thead"),k.Sb(12,"tr"),k.Sb(13,"th"),k.Ac(14,"Product Id"),k.Rb(),k.Sb(15,"th"),k.Ac(16,"Product Name"),k.Rb(),k.Sb(17,"th"),k.Ac(18,"Price Per Unit"),k.Rb(),k.Sb(19,"th",6),k.Ac(20,"Quantity"),k.Rb(),k.Sb(21,"th"),k.Ac(22,"Total"),k.Rb(),k.Rb(),k.Rb(),k.Sb(23,"tbody"),k.yc(24,L,25,14,"tr",7),k.cc(25,"async"),k.Sb(26,"tr"),k.Sb(27,"td",8),k.Ac(28,"\xa0"),k.Rb(),k.Rb(),k.Sb(29,"tr"),k.Sb(30,"td",9),k.Sb(31,"strong"),k.Ac(32,"TOTAL"),k.Rb(),k.Rb(),k.Sb(33,"td"),k.Ac(34),k.cc(35,"currency"),k.cc(36,"async"),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Sb(37,"div",10),k.Sb(38,"h2",1),k.Ac(39,"Discount"),k.Rb(),k.Sb(40,"section",11),k.Sb(41,"section",12),k.Sb(42,"div",13),k.Sb(43,"input",14),k.Zb("ngModelChange",function(t){return e.isDiscounted=t}),k.Rb(),k.Sb(44,"label",15),k.Ac(45," Apply Discount "),k.Rb(),k.Rb(),k.Rb(),k.yc(46,U,8,1,"section",16),k.yc(47,W,4,1,"section",16),k.Rb(),k.Rb(),k.Sb(48,"div",10),k.Sb(49,"h2",1),k.Ac(50,"Summary"),k.Rb(),k.Sb(51,"section",17),k.yc(52,Y,5,1,"section",18),k.Sb(53,"section",19),k.Sb(54,"section",20),k.Ac(55," Total Amount Due "),k.Rb(),k.Sb(56,"section",21),k.Ac(57),k.cc(58,"currency"),k.Rb(),k.Rb(),k.Rb(),k.Rb(),k.Sb(59,"div",22),k.Sb(60,"h2",1),k.Ac(61,"Payment Method"),k.Rb(),k.Sb(62,"div",23),k.Sb(63,"div",24),k.Sb(64,"div",25),k.Sb(65,"input",26),k.Zb("ngModelChange",function(t){return e.paymentMethod=t}),k.Rb(),k.Sb(66,"label",27),k.Ac(67,"Cash"),k.Rb(),k.Rb(),k.Sb(68,"div",25),k.Sb(69,"input",28),k.Zb("ngModelChange",function(t){return e.paymentMethod=t}),k.Rb(),k.Sb(70,"label",29),k.Ac(71,"On Credit"),k.Rb(),k.Rb(),k.Sb(72,"div",25),k.Sb(73,"input",30),k.Zb("ngModelChange",function(t){return e.paymentMethod=t}),k.Rb(),k.Sb(74,"label",31),k.Ac(75,"M - PESA"),k.Rb(),k.Rb(),k.Rb(),k.yc(76,z,8,5,"div",32),k.yc(77,H,5,1,"div",32),k.yc(78,tt,10,3,"div",32),k.Rb(),k.Rb(),k.Rb(),k.Sb(79,"section",33),k.Sb(80,"section",34),k.Sb(81,"button",35),k.Zb("click",function(){return e.submitCart()}),k.Ac(82," Submit "),k.yc(83,et,1,0,"i",36),k.cc(84,"async"),k.yc(85,nt,1,0,"i",37),k.cc(86,"async"),k.Rb(),k.Rb(),k.Rb()),2&t&&(k.Ab(24),k.hc("ngForOf",k.dc(25,16,e.cartItems$)),k.Ab(10),k.Bc(k.ec(35,18,k.dc(36,21,e.cartItemsTotal$),"KES ")),k.Ab(9),k.hc("ngModel",e.isDiscounted),k.Ab(3),k.hc("ngIf",e.isDiscounted),k.Ab(1),k.hc("ngIf",e.isDiscounted),k.Ab(5),k.hc("ngIf",e.isDiscounted),k.Ab(5),k.Cc(" ",k.ec(58,23,e.amountDue,"KES ")," "),k.Ab(8),k.hc("ngModel",e.paymentMethod),k.Ab(4),k.hc("ngModel",e.paymentMethod),k.Ab(4),k.hc("ngModel",e.paymentMethod),k.Ab(3),k.hc("ngIf","cash"===e.paymentMethod),k.Ab(1),k.hc("ngIf","on-credit"===e.paymentMethod),k.Ab(1),k.hc("ngIf","m-pesa"===e.paymentMethod),k.Ab(3),k.hc("disabled",e.cartItemsTotal<=0),k.Ab(2),k.hc("ngIf",!1===k.dc(84,26,e.submitInProgressAction$)),k.Ab(2),k.hc("ngIf",k.dc(86,28,e.submitInProgressAction$)))},directives:[o.m,s.a,s.m,s.o,o.n,s.r,s.b,s.u,s.p,s.w],pipes:[o.b,o.d,o.u],styles:[".button-group[_ngcontent-%COMP%]   .btn-success[_ngcontent-%COMP%]{pointer-events:none}"],changeDetection:0}),ct),st=r("E3ii"),lt=r("Mo0h"),dt=[{path:"",pathMatch:"full",data:{breadcrumb:null},component:(rt=function t(e){d(this,t),this.linkService=e,this.links$=this.linkService.salesLinks$},rt.\u0275fac=function(t){return new(t||rt)(k.Mb(st.a))},rt.\u0275cmp=k.Gb({type:rt,selectors:[["app-sales"]],decls:3,vars:1,consts:[[3,"links$"]],template:function(t,e){1&t&&(k.Sb(0,"h1"),k.Ac(1,"Sales"),k.Rb(),k.Nb(2,"app-links",0)),2&t&&(k.Ab(2),k.hc("links$",e.links$))},directives:[lt.a],styles:[""]}),rt)},{path:"make-sale",data:{breadcrumb:"Make Sale"},component:bt,canDeactivate:[r("wNMA").a]},{path:"edit-sale",data:{breadcrumb:"Edit Sale"},loadChildren:function(){return Promise.all([r.e(6),r.e(0),r.e(26)]).then(r.bind(null,"aPer")).then(function(t){return t.EditSoldProductsModule})}}],pt=((ot=function t(){d(this,t)}).\u0275mod=k.Kb({type:ot}),ot.\u0275inj=k.Jb({factory:function(t){return new(t||ot)},imports:[[u.j.forChild(dt)],u.j]}),ot),mt=Object(m.n)("[Sale] Load Sales"),ft=Object(m.n)("[Sale] Load Sales Success",Object(m.s)()),ht=Object(m.n)("[Sale] Load Sales Failure",Object(m.s)()),yt=Object(m.p)({},Object(m.r)(mt,function(t){return t}),Object(m.r)(ft,function(t){return t}),Object(m.r)(ht,function(t){return t})),St=r("9jGm"),gt=r("bOdf"),vt=r("JIr8"),Rt=r("EY2u"),At=r("LRne"),It=((at=function t(e){var n=this;d(this,t),this.actions$=e,this.loadSales$=Object(St.c)(function(){return n.actions$.pipe(Object(St.d)(mt),Object(gt.a)(function(){return Rt.a.pipe(Object(h.a)(function(t){return ft({data:t})}),Object(vt.a)(function(t){return Object(At.a)(ht({error:t}))}))}))})}).\u0275fac=function(t){return new(t||at)(k.Wb(St.a))},at.\u0275prov=k.Ib({token:at,factory:at.\u0275fac}),at),jt=((it=function t(){d(this,t)}).\u0275mod=k.Kb({type:it}),it.\u0275inj=k.Jb({factory:function(t){return new(t||it)},imports:[[o.c,m.j.forFeature("sale",yt),St.b.forFeature([It])]]}),it),Pt=r("RecK"),Ot=r("HEfn"),Mt=r("IVO7"),kt=r("MPUB"),wt=r("X/30"),Ct=r("jdGB"),Nt=r("Yg/+"),xt=((ut=function t(){d(this,t)}).\u0275mod=k.Kb({type:ut}),ut.\u0275inj=k.Jb({factory:function(t){return new(t||ut)},imports:[[o.c,pt,jt,Pt.a,V.b.forRoot(),s.j,s.s,$.c.forRoot(),m.j.forFeature("cart",A),Ot.a,Mt.a,kt.a,wt.a,Ct.a,N.b,Nt.a]]}),ut)},e6Kq:function(e,n,c){"use strict";c.d(n,"a",function(){return r});var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return function t(){d(this,t)}}();return function(e){a(c,e);var n=b(c);function c(){return d(this,c),n.apply(this,arguments)}return i(c,[{key:"getDate",value:function(e){e.setHours(-e.getTimezoneOffset()/60,0,0);var n=t(e.toISOString().split("-"),3),c=n[0],r=n[1],o=n[2];return"".concat(c,"-").concat(r,"-").concat(o.substr(0,2))}}]),c}(e)}}}])}();